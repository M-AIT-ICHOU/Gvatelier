:root{
  /* Red & white palette inspired by provided screenshot */
  --bg: #ffffff; /* page background */
  --bg-2: #ffffff; /* secondary background stop (kept white) */
  --card: #ffffff;
  --surface: #ffffff;
  --text-dark: #111827;
  --muted: #8b98a6;
  --muted-border: rgba(17,24,39,0.06);
  --accent: #e11d48; /* primary red/pink accent */
  --accent-2: #fb7185; /* lighter pink accent */
  --accent-cyan: #06b6d4;
  --accent-success: #10b981;
  --accent-warning: #f97316;
  --danger: #ef4444;
  --shadow: 0 14px 48px rgba(17,24,39,0.06);
  --radius: 14px;
  --gap: 14px;
  --font-base: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --font-size: 14px;
  --sidebar-width: 160px;
  --right-width: 320px;
}

/* Force fixed height for analytics full charts to avoid runaway canvas sizing */
.analytics-fullcharts canvas{
  height:220px !important;
  max-height:220px !important;
  display:block;
  width:100% !important;
}

/* Robust fixed-frame for full charts to prevent Canvas from growing */
.chart-frame{ position:relative; height:220px; max-height:220px; overflow:hidden; }
.chart-frame canvas{ position:absolute !important; left:0; top:0; width:100% !important; height:100% !important; }
*{box-sizing:border-box}
:root{--page-padding:20px}
body{background:linear-gradient(180deg,var(--bg), var(--bg-2));margin:0;color:var(--text-dark);font-family:var(--font-base);font-size:14px;line-height:1.45}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 18px;background:transparent;border-bottom:0}
/* fix header height so map can start below it */
.topbar{height:64px}
.brand{font-weight:800;color:var(--accent);font-size:16px}
.topbar{background:var(--card);box-shadow:0 2px 8px rgba(16,24,40,0.04);border-bottom:1px solid rgba(16,24,40,0.04);padding:12px 20px}
topbar .brand{display:flex;align-items:center;gap:12px}
.topbar .brand::before{display:none}
.brand-logo{width:40px;height:40px;border-radius:8px;object-fit:cover;border:1px solid rgba(0,0,0,0.06);box-shadow:0 6px 18px rgba(17,24,39,0.06)}
.brand-text{font-weight:800;color:var(--accent);font-size:16px}
.topbar .actions{display:flex;gap:12px;align-items:center}
.user-bubble{width:36px;height:36px;border-radius:999px;background:linear-gradient(180deg,#fff,#f3f6fb);display:flex;align-items:center;justify-content:center;border:1px solid rgba(16,24,40,0.04);font-weight:700;color:var(--accent)}
.container{display:grid;grid-template-columns:1fr;gap:20px;padding:22px;height:100%}
.left{grid-column:1 / span 1}
.right{grid-column:1 / span 1}

/* Application grid wrapping sidebar + main + right column */
.app-grid{display:grid;grid-template-columns:var(--sidebar-width) 1fr;gap:18px;align-items:stretch;padding:18px;max-width:none;width:calc(100% - 40px);margin:28px 20px;background:var(--card);border-radius:16px;box-shadow:0 24px 60px rgba(11,21,58,0.12);min-height:calc(100vh - 120px)}
.sidebar{background:linear-gradient(180deg,var(--accent-2),var(--accent));border-radius:12px;padding:12px}
.sidebar-inner{position:sticky;top:36px;padding:8px;display:flex;flex-direction:column;align-items:flex-start;gap:12px}
.sidebar .logo{font-weight:800;color:#fff;font-size:14px;margin-bottom:6px}
.nav{display:flex;flex-direction:column;gap:8px;width:100%}
.nav-item{display:flex;align-items:center;justify-content:flex-start;padding:12px 14px;border-radius:10px;color:rgba(255,255,255,0.98);background:transparent;font-weight:700;cursor:pointer;white-space:nowrap;transition:all .12s ease}
.nav-item:hover{background:rgba(255,255,255,0.06);transform:translateX(2px)}
.nav-item.active{background:#fff;color:var(--accent);box-shadow:0 6px 18px rgba(17,24,39,0.06);border-left:4px solid var(--accent);}

/* Small icon before each nav item (color accents) */
/* hide tab icons: remove decorative pseudo-elements for a cleaner sidebar */
.nav-item::before{display:none !important}
/* Per-tab decorative tiles */
#tabStudyBtn::before{background-image:linear-gradient(135deg,#fff 0%,#fef3f5 100%);border:1px solid rgba(0,0,0,0.04)}
#tabVisualisationBtn::before{background-image:linear-gradient(135deg,var(--accent-2),var(--accent));border:1px solid rgba(0,0,0,0.06)}
#tabAnalyticsBtn::before{background-image:linear-gradient(180deg,#fef3f5,#fecdd3);border:1px solid rgba(0,0,0,0.04)}
#tabResumeBtn::before{background-image:linear-gradient(180deg,#fde68a,#fca5a5);border:1px solid rgba(0,0,0,0.04)}
#tabAboutBtn::before{background-image:linear-gradient(180deg,#fee2e2,#fecaca);border:1px solid rgba(0,0,0,0.04)}
.right-col{display:none}
.card{background:var(--card);border-radius:10px;padding:16px;box-shadow:var(--shadow);margin-bottom:18px;border:1px solid rgba(16,24,40,0.04);overflow:hidden}
.card h3, .card h4{margin:0 0 12px 0;color:#17202a}
.kpi-card .kpi-value{font-variant-numeric:tabular-nums}
.main-account{display:flex;justify-content:space-between;align-items:center;padding:22px}
/* make the parent card transparent so only individual grid cells show as boxes */
.card.main-account{background:transparent;padding:8px;border:none;box-shadow:none}
.big-balance{font-size:28px;font-weight:700;color:#1f3d3a}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.small-card{padding:18px;min-height:72px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.large{min-height:260px}
.tx-list{list-style:none;padding:0;margin:0}
.tx-list li{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #f0f0f0}
.map-card .map-tools{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.map-card .charts canvas{width:100%!important;height:160px!important;margin-top:12px}
.select, select{padding:6px 8px;border-radius:6px;border:1px solid #e1e6ea}

/* Full-screen background map */
html, body {height:100%;}
#mapFrame.persistent-map, .persistent-map{position:relative;width:100%;height:100%;max-height:none;margin:0 0 18px 0}
#map {
  position:absolute;inset:0;width:100%;height:100%;z-index:0;border-radius:14px;overflow:hidden;box-shadow:0 12px 36px rgba(16,24,40,0.06);
}

.map-panel{position:absolute;inset:0;z-index:20;overflow:auto;padding:22px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,252,0.98));border-radius:12px;box-shadow:0 12px 36px rgba(16,24,40,0.06)}
.map-panel.hidden{display:none}

/* Ensure UI overlays sit above the map */
.container{position:relative;z-index:700;padding:22px}
.topbar{position:relative;z-index:705}
.card{background:rgba(255,255,255,0.9)}

/* Remove default map-card sizing from template to let #map fill background */
.map-card{background:transparent;padding:0;border:none}

/* Visual demarcation for selector grid cells */
.selector-grid > div{background:#fff;padding:12px;border-radius:12px;box-shadow:0 10px 30px rgba(16,24,40,0.04);border:1px solid rgba(16,24,40,0.04)}
.selector-grid{outline:none;padding:8px;border-radius:12px}
/* make selector grid span full page width and align with page grid overlay */
.selector-grid{position:relative; z-index:1; display:grid; grid-template-columns: repeat(9, 1fr); grid-template-rows:90px 80px 80px 160px 160px; column-gap:var(--gap); row-gap:22px; align-items:start; padding:14px 20px; overflow:auto; max-height:none}
.selector-grid > div{background:rgba(255,255,255,0.95);overflow:hidden;word-wrap:break-word;box-shadow:none;border:1px solid rgba(0,0,0,0.10)}

/* Reduce sizes for all selector-grid cells except the first (commune selector) */
.selector-grid > div:not(:first-child){
  padding:6px;
  min-height:48px;
}

/* Slightly smaller chart canvases for compact view */
.selector-grid canvas{height:120px !important}
.selector-grid canvas#donutTFV{height:120px!important}
.selector-grid canvas#txChartSmall, .selector-grid canvas#rrChartSmall, .selector-grid canvas#ummChartSmall {height:120px!important}

/* Reduce KPI size to match compact layout */
.kpi-value{font-size:16px;color:var(--accent);font-weight:700}

/* Slightly tighten cell header/body spacing */
.cell-header{padding:8px 10px;border-bottom:1px solid rgba(18,12,54,0.04)}
.cell-body{padding:4px 2px 6px 2px}

/* Professional cell header and body */
.cell-header{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:transparent;margin:-12px -12px 10px -12px;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
.cell-header .small{margin:0;color:var(--muted);font-weight:600;font-size:13px}
.cell-toggle{background:#fff;border:1px solid rgba(0,0,0,0.08);padding:6px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;width:34px;height:34px}
.cell-toggle svg{display:block;width:18px;height:18px}
.cell-toggle:hover{background:#f3f6f9}
.cell-body{padding:4px 2px 6px 2px}
.selector-grid > div.collapsed{opacity:0.85}
.selector-grid > div.collapsed .cell-body{display:none}

/* controls wrapper (export + toggle) */
.cell-controls{display:flex;gap:8px;align-items:center}
.cell-export{background:#fff;border:1px solid rgba(18,12,54,0.06);padding:6px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;width:34px;height:34px}
.cell-export svg{display:block;width:16px;height:16px}
.cell-export:hover{background:#f3f6f9}
.cell-csv{background:#fff;border:1px solid rgba(0,0,0,0.08);padding:6px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;width:34px;height:34px}
.cell-csv svg{display:block;width:16px;height:16px}
.cell-csv:hover{background:#f3f6f9}

/* subtle transitions */
.selector-grid > div, .cell-toggle, .cell-export{transition:all .18s ease}

/* Slightly stronger card look */
.selector-grid > div{box-shadow:0 8px 24px rgba(16,24,40,0.08);border-radius:var(--radius)}

.selector-grid canvas{width:100%!important}
.selector-grid canvas#donutTFV{height:160px!important}
.selector-grid canvas#txChartSmall, .selector-grid canvas#rrChartSmall, .selector-grid canvas#ummChartSmall {height:160px!important}
.selector-grid .chart-title{font-size:12px;color:#666;margin-bottom:6px}

/* KPI styles */
.kpi{background:linear-gradient(180deg, #ffffff, #fbfdff);border:1px solid rgba(16,24,40,0.04);padding:10px;border-radius:8px;text-align:left}
.kpi-title{font-size:12px;color:var(--muted);margin-bottom:6px}
.kpi-value{font-size:20px;font-weight:700;color:var(--accent);margin-bottom:4px}
.kpi-sub{font-size:12px;color:#9aa3aa}

/* KPI row above map */
.kpi-row{display:flex;gap:14px;margin-bottom:14px}
.kpi-card{flex:1;background:#ffffff;padding:14px 16px;border-radius:10px;border:1px solid rgba(16,24,40,0.04);box-shadow:0 6px 20px rgba(16,24,40,0.05);text-align:left}
.kpi-card .kpi-title{font-size:12px;color:var(--muted);margin-bottom:8px}
.kpi-card .kpi-value{font-size:22px;font-weight:800;color:var(--accent);letter-spacing:0.2px}

/* Right column small panels */
.right-col{display:flex;flex-direction:column;gap:12px}
.right-col .small-panel{padding:12px;background:#fff;border-radius:10px;border:1px solid rgba(16,24,40,0.04);box-shadow:0 8px 20px rgba(16,24,40,0.04)}
.right-col canvas{width:100%!important;height:auto!important}

/* Small legend styles inside small-panel */
.small-panel .legend-title{font-size:12px;color:var(--muted);margin-bottom:8px}
.small-panel .legend-scale{display:flex;gap:6px;align-items:center;font-size:12px;color:#445}

/* reduce main container padding to match dense dashboard */
.container{padding:8px}

/* Utility to align content to the bottom of the grid cell */
.align-bottom{display:flex;flex-direction:column;justify-content:flex-end}

/* TX container: remove any bottom border/line and reduce inner divider */
.tx-container{box-shadow:none;border:none;padding-bottom:6px}
.tx-container .small{margin-top:4px;margin-bottom:0}

/* Allow map dragging through empty areas of the fixed selector-grid while keeping controls interactive */
.selector-grid{pointer-events:auto}
.selector-grid > div, .selector-grid input, .selector-grid button, .selector-grid select, .selector-grid canvas { pointer-events:auto }

/* Full-page debug grid overlay removed */
.page-grid-overlay{display:none !important}
/* ensure empty grid cells are visible and have minimum height */
.selector-grid > div{min-height:56px}

/* Prevent map-panel children from stretching indefinitely: bound heights and enable internal scrolling */
.map-panel > .card{max-height:calc(100% - 44px);overflow:auto}
.map-panel .selector-grid{max-height:calc(100% - 220px);overflow:auto}
.map-panel .analytics-top{flex-wrap:wrap;gap:12px}
.map-panel .kpi-row{flex-wrap:wrap}
.map-panel canvas{max-width:100%;height:auto}

/* Analytics tab: fixed sizing for KPI small cards and consistent container sizes */
#analyticsTab .analytics-top .kpi-card{flex:0 0 160px;max-width:160px;width:160px;height:140px;display:flex;flex-direction:column;justify-content:center;align-items:center}
#analyticsTab .analytics-top .kpi-card + .kpi-card{margin-left:0}
#analyticsTab .analytics-top .kpi-card.flex-grow{flex:1 1 auto;min-height:140px}
#analyticsTab .card{min-height:420px}
#analyticsTab .selector-grid > div{min-height:120px}

@media (max-width:900px){
  #analyticsTab .analytics-top .kpi-card{flex:0 0 140px;max-width:140px;width:140px;height:120px}
  #analyticsTab .card{min-height:320px}
}

/* Debug helper: visibly outline each cell (toggle by adding .debug-borders to body) */
body.debug-borders .selector-grid{border:2px dashed rgba(0,0,0,0.15)}
body.debug-borders .selector-grid > div{outline:1px solid rgba(0,0,0,0.12)}

/* Compact file label and filename truncation */
.commune-input-row{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.commune-input-row .data-select{flex:0 0 240px;padding:6px 8px;border-radius:6px;border:1px solid #e1e6ea;font-size:13px}
.commune-input-row .default-view-btn{margin-left:0}
.main-account .small{font-size:12px;color:var(--muted);margin-bottom:4px}
#loadedFile, #loadedFile_study{font-size:16px;margin:4px 0;max-width:320px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#dataFileSelect{font-size:13px;padding:6px 8px;border-radius:6px;border:1px solid #e1e6ea;width:100%}

/* Slight typography refinements for headings inside cards */
.card h2{font-size:20px;margin-bottom:12px;color:#0f1724}
.card h3{font-size:16px;margin:8px 0;color:#334155}
.card p, .card li{font-size:14px;color:#475569}

/* Reduce card padding slightly for denser layout */
.card{padding:14px}

/* Make the about-card content more readable */
.about-card ul{margin:8px 0 12px 18px}
.about-card section{margin-bottom:12px}
#dataFileSelect{font-size:13px;padding:6px 8px;border-radius:6px;border:1px solid #e1e6ea;width:100%}

/* Ensure Leaflet controls (layer switcher, zoom) appear above header overlay */
.leaflet-control{ z-index: 2000 !important; }
.leaflet-control-container{ z-index: 2000 !important; pointer-events: auto; }

/* Grid overlay canvas and toggle button */
.page-grid-overlay{pointer-events:none;}
.page-grid-overlay canvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;}
.grid-toggle{margin-left:12px;padding:6px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer;font-size:13px}
.grid-toggle.active{background:#0f9d58;color:#fff;border-color:transparent}

.default-view-btn{margin-left:16px;padding:6px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer;font-size:13px}
.default-view-btn:hover{background:#f3f6f9}
.default-view-btn:active{transform:translateY(1px)}

@media (max-width:720px){
  .commune-input-row .data-select{flex:1 1 100%}
  .commune-input-row .default-view-btn{flex:0 0 auto;margin-top:8px}
}

/* Responsive grid: collapse columns on smaller screens */
@media (max-width:1200px){
  .selector-grid{grid-template-columns: repeat(6, 1fr); grid-template-rows:90px 80px 120px 160px 160px}
}
@media (max-width:900px){
  .selector-grid{grid-template-columns: repeat(2, 1fr); grid-template-rows:auto; padding:12px}
  .selector-grid > div{min-height:72px}
  .selector-grid{bottom:18px}
}

/* Map legend positioning (placed inside selector-grid at row 4, column 5) */
.selector-grid #mapLegendContainer{position:relative; right:auto; bottom:auto; z-index:1800; margin:0; padding:0}
.selector-grid #mapLegendContainer .info.legend{max-width:260px}

/* UMM canvas sizing in selector grid (match RR reference) */
#ummChartSmall{height:140px !important}

/* Simple tabs styling for dashboard top */
.tabs{display:flex;gap:10px;padding:10px 22px;background:transparent;align-items:center;position:relative;z-index:1800}
.tab{border:none;background:rgba(255,255,255,0.12);padding:8px 14px;border-radius:999px;cursor:pointer;font-weight:700;color:rgba(255,255,255,0.9);backdrop-filter: blur(4px)}
.tab.active{background:#fff;color:var(--accent);box-shadow:0 6px 18px rgba(39,30,90,0.09)}
.hidden{display:none}
.about-content .card{max-width:820px}
:root{
  /* Red & white palette inspired by provided screenshot */
  --bg: #ffffff; /* page background */
.about-content .card{max-width:820px}
}
```
:root{
  /* Red & white palette inspired by provided screenshot */
  --bg: #ffffff; /* page background */
  --bg-2: #ffffff; /* secondary background stop (kept white) */
  --card: #ffffff;
  --surface: #ffffff;
  --text-dark: #111827;
  --muted: #8b98a6;
  --muted-border: rgba(17,24,39,0.06);
  --accent: #e11d48; /* primary red/pink accent */
  --accent-2: #fb7185; /* lighter pink accent */
  --accent-cyan: #06b6d4;
  --accent-success: #10b981;
  --accent-warning: #f97316;
  --danger: #ef4444;
  --shadow: 0 14px 48px rgba(17,24,39,0.06);
  --radius: 14px;
  --gap: 14px;
  --font-base: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --font-size: 14px;
  --sidebar-width: 160px;
  --right-width: 320px;
}

/* Force fixed height for analytics full charts to avoid runaway canvas sizing */
.analytics-fullcharts canvas{
  height:220px !important;
  max-height:220px !important;
  display:block;
  width:100% !important;
}

/* Robust fixed-frame for full charts to prevent Canvas from growing */
.chart-frame{ position:relative; height:220px; max-height:220px; overflow:hidden; }
.chart-frame canvas{ position:absolute !important; left:0; top:0; width:100% !important; height:100% !important; }
*{box-sizing:border-box}
:root{--page-padding:20px}
body{background:linear-gradient(180deg,var(--bg), var(--bg-2));margin:0;color:var(--text-dark);font-family:var(--font-base);font-size:14px;line-height:1.45}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 18px;background:transparent;border-bottom:0}
/* fix header height so map can start below it */
.topbar{height:64px}
.brand{font-weight:800;color:var(--accent);font-size:16px}
.topbar{background:var(--card);box-shadow:0 2px 8px rgba(16,24,40,0.04);border-bottom:1px solid rgba(16,24,40,0.04);padding:12px 20px}
topbar .brand{display:flex;align-items:center;gap:12px}
.topbar .brand::before{display:none}
.brand-logo{width:40px;height:40px;border-radius:8px;object-fit:cover;border:1px solid rgba(0,0,0,0.06);box-shadow:0 6px 18px rgba(17,24,39,0.06)}
.brand-text{font-weight:800;color:var(--accent);font-size:16px}
.topbar .actions{display:flex;gap:12px;align-items:center}
.user-bubble{width:36px;height:36px;border-radius:999px;background:linear-gradient(180deg,#fff,#f3f6fb);display:flex;align-items:center;justify-content:center;border:1px solid rgba(16,24,40,0.04);font-weight:700;color:var(--accent)}
.container{display:grid;grid-template-columns:1fr;gap:20px;padding:22px;height:100%}
.left{grid-column:1 / span 1}
.right{grid-column:1 / span 1}

/* Application grid wrapping sidebar + main + right column */
.app-grid{display:grid;grid-template-columns:var(--sidebar-width) 1fr;gap:18px;align-items:stretch;padding:18px;max-width:none;width:calc(100% - 40px);margin:28px 20px;background:var(--card);border-radius:16px;box-shadow:0 24px 60px rgba(11,21,58,0.12);min-height:calc(100vh - 120px)}
.sidebar{background:linear-gradient(180deg,var(--accent-2),var(--accent));border-radius:12px;padding:12px}
.sidebar-inner{position:sticky;top:36px;padding:8px;display:flex;flex-direction:column;align-items:flex-start;gap:12px}
.sidebar .logo{font-weight:800;color:#fff;font-size:14px;margin-bottom:6px}
.nav{display:flex;flex-direction:column;gap:8px;width:100%}
.nav-item{display:flex;align-items:center;justify-content:flex-start;padding:12px 14px;border-radius:10px;color:rgba(255,255,255,0.98);background:transparent;font-weight:700;cursor:pointer;white-space:nowrap;transition:all .12s ease}
.nav-item:hover{background:rgba(255,255,255,0.06);transform:translateX(2px)}
.nav-item.active{background:#fff;color:var(--accent);box-shadow:0 6px 18px rgba(17,24,39,0.06);border-left:4px solid var(--accent);}

/* Small icon before each nav item (color accents) */
/* hide tab icons: remove decorative pseudo-elements for a cleaner sidebar */
.nav-item::before{display:none !important}
/* Per-tab decorative tiles */
#tabStudyBtn::before{background-image:linear-gradient(135deg,#fff 0%,#fef3f5 100%);border:1px solid rgba(0,0,0,0.04)}
#tabVisualisationBtn::before{background-image:linear-gradient(135deg,var(--accent-2),var(--accent));border:1px solid rgba(0,0,0,0.06)}
#tabAnalyticsBtn::before{background-image:linear-gradient(180deg,#fef3f5,#fecdd3);border:1px solid rgba(0,0,0,0.04)}
#tabResumeBtn::before{background-image:linear-gradient(180deg,#fde68a,#fca5a5);border:1px solid rgba(0,0,0,0.04)}
#tabAboutBtn::before{background-image:linear-gradient(180deg,#fee2e2,#fecaca);border:1px solid rgba(0,0,0,0.04)}
.right-col{display:none}
.card{background:var(--card);border-radius:10px;padding:16px;box-shadow:var(--shadow);margin-bottom:18px;border:1px solid rgba(16,24,40,0.04);overflow:hidden}
.card h3, .card h4{margin:0 0 12px 0;color:#17202a}
.kpi-card .kpi-value{font-variant-numeric:tabular-nums}
.main-account{display:flex;justify-content:space-between;align-items:center;padding:22px}
/* make the parent card transparent so only individual grid cells show as boxes */
.card.main-account{background:transparent;padding:8px;border:none;box-shadow:none}
.big-balance{font-size:28px;font-weight:700;color:#1f3d3a}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.small-card{padding:18px;min-height:72px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.large{min-height:260px}
.tx-list{list-style:none;padding:0;margin:0}
.tx-list li{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #f0f0f0}
.map-card .map-tools{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.map-card .charts canvas{width:100%!important;height:160px!important;margin-top:12px}
.select, select{padding:6px 8px;border-radius:6px;border:1px solid #e1e6ea}

/* Full-screen background map */
html, body {height:100%;}
#mapFrame.persistent-map, .persistent-map{position:relative;width:100%;height:100%;max-height:none;margin:0 0 18px 0}
#map {
  position:absolute;inset:0;width:100%;height:100%;z-index:0;border-radius:14px;overflow:hidden;box-shadow:0 12px 36px rgba(16,24,40,0.06);
}

.map-panel{position:absolute;inset:0;z-index:20;overflow:auto;padding:22px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,252,0.98));border-radius:12px;box-shadow:0 12px 36px rgba(16,24,40,0.06)}
.map-panel.hidden{display:none}

/* Ensure UI overlays sit above the map */
.container{position:relative;z-index:700;padding:22px}
.topbar{position:relative;z-index:705}
.card{background:rgba(255,255,255,0.9)}

/* Remove default map-card sizing from template to let #map fill background */
:root{
  /* Red & white palette inspired by provided screenshot */
  --bg: #ffffff; /* page background */
  --bg-2: #ffffff; /* secondary background stop (kept white) */
  --card: #ffffff;
  --surface: #ffffff;
  --text-dark: #111827;
  --muted: #8b98a6;
  --muted-border: rgba(17,24,39,0.06);
  --accent: #e11d48; /* primary red/pink accent */
  --accent-2: #fb7185; /* lighter pink accent */
  --accent-cyan: #06b6d4;
  --accent-success: #10b981;
  --accent-warning: #f97316;
  --danger: #ef4444;
  --shadow: 0 14px 48px rgba(17,24,39,0.06);
  --radius: 14px;
  --gap: 14px;
  --font-base: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --font-size: 14px;
  --sidebar-width: 160px;
  --right-width: 320px;
}

/* Force fixed height for analytics full charts to avoid runaway canvas sizing */
.analytics-fullcharts canvas{
  height:220px !important;
  max-height:220px !important;
  display:block;
  width:100% !important;
}

/* Robust fixed-frame for full charts to prevent Canvas from growing */
.chart-frame{ position:relative; height:220px; max-height:220px; overflow:hidden; }
.chart-frame canvas{ position:absolute !important; left:0; top:0; width:100% !important; height:100% !important; }
*{box-sizing:border-box}
:root{--page-padding:20px}
body{background:linear-gradient(180deg,var(--bg), var(--bg-2));margin:0;color:var(--text-dark);font-family:var(--font-base);font-size:14px;line-height:1.45}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 18px;background:transparent;border-bottom:0}
/* fix header height so map can start below it */
.topbar{height:64px}
.brand{font-weight:800;color:var(--accent);font-size:16px}
.topbar{background:var(--card);box-shadow:0 2px 8px rgba(16,24,40,0.04);border-bottom:1px solid rgba(16,24,40,0.04);padding:12px 20px}
topbar .brand{display:flex;align-items:center;gap:12px}
.topbar .brand::before{display:none}
.brand-logo{width:40px;height:40px;border-radius:8px;object-fit:cover;border:1px solid rgba(0,0,0,0.06);box-shadow:0 6px 18px rgba(17,24,39,0.06)}
.brand-text{font-weight:800;color:var(--accent);font-size:16px}
.topbar .actions{display:flex;gap:12px;align-items:center}
.user-bubble{width:36px;height:36px;border-radius:999px;background:linear-gradient(180deg,#fff,#f3f6fb);display:flex;align-items:center;justify-content:center;border:1px solid rgba(16,24,40,0.04);font-weight:700;color:var(--accent)}
.container{display:grid;grid-template-columns:1fr;gap:20px;padding:22px;height:100%}
.-

